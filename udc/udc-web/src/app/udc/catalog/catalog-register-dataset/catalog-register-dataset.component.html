<!--
Copyright 2019 PayPal Inc.

Licensed to the Apache Software Foundation (ASF) under one or more
contributor license agreements.  See the NOTICE file distributed with
this work for additional information regarding copyright ownership.
The ASF licenses this file to You under the Apache License, Version 2.0
(the "License"); you may not use this file except in compliance with
the License.  You may obtain a copy of the License at

   http://www.apache.org/licenses/LICENSE-2.0

Unless required by applicable law or agreed to in writing, software
distributed under the License is distributed on an "AS IS" BASIS,
WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
See the License for the specific language governing permissions and
limitations under the License.
-->

<div fxLayout="row" fxLayoutAlign="center center" fxLayoutWrap="wrap">
  <div fxFlex="75" class="main-container">
    <form [formGroup]="datasetForm">
      <mat-card>
        <mat-card-title color="primary">Register Dataset</mat-card-title>
        <mat-card-content>
          <div fxLayout="row" fxLayoutAlign="start start" class="field-row appname-row">
            <div fxFlex="45" fxFlexAlign="center">
              <label>Requester ID</label>
            </div>
            <div fxFlex="55" fxFlexAlign="center">
              <mat-form-field [floatLabel]="'never'">
                  <input matInput required="true" placeholder="Requester ID" value="{{username}}" disabled>
              </mat-form-field>

            </div>
          </div>

          <div fxLayout="row" fxLayoutAlign="start start" class="field-row appname-row">
            <div fxFlex="45" fxFlexAlign="center">
              <label>Dataset</label>
              <p class="info">
                {{ datasetHint }}
              </p>
            </div>
            <div fxFlex="55" fxFlexAlign="center">
              <mat-form-field [floatLabel]="'never'">
                  <input matInput required formControlName="dataset" placeholder="Required Field"
                         (change)="validateDataset($event)">
                  <mat-hint *ngIf="formErrors.dataset" class="alert-danger">
                    {{ formErrors.dataset }}
                  </mat-hint>
              </mat-form-field>

            </div>
          </div>

          <div fxLayout="row" fxLayoutAlign="start start" class="field-row appname-row">
            <label fxFlex="45" fxFlexAlign="center">
              Description
            </label>
            <div fxFlex="55" fxFlexAlign="center">
              <mat-form-field [floatLabel]="'never'">
                <textarea matInput mat-maxlength="150" rows="5" mat-select-on-focus
                          formControlName="description" placeholder="Required Field"
                          (change)="validateDescription($event)"></textarea>
                  <mat-hint *ngIf="formErrors.description" class="alert-danger">
                    {{ formErrors.description }}
                  </mat-hint>
              </mat-form-field>

            </div>
          </div>

          <div fxLayout="row" fxLayoutAlign="start start" class="field-row appname-row">
            <label fxFlex="45" fxFlexAlign="center">
              Storage Category
            </label>
            <div fxFlex="55" fxFlexAlign="center">
              <mat-form-field [floatLabel]="'never'">
                <mat-select required placeholder="Required Field"
                            formControlName="storageCategory" (selectionChange)="onStorageCategoryChange()">
                  <mat-option *ngFor="let storageCategory of storageCategories" [value]="storageCategory">
                    {{ storageCategory['storageName'] }}
                  </mat-option>
                </mat-select>
              </mat-form-field>
              <mat-progress-bar mode="indeterminate" *ngIf="dbLoading"></mat-progress-bar>
            </div>
          </div>

          <div fxLayout="row" fxLayoutAlign="start start" class="field-row appname-row">
            <label fxFlex="45" fxFlexAlign="center">
              Storage Type
            </label>
            <div fxFlex="55" fxFlexAlign="center">
              <mat-form-field [floatLabel]="'never'">
                <mat-select required placeholder="Required Field"
                            formControlName="storageType" (selectionChange)="onStorageTypeChange()">
                  <mat-option *ngFor="let storageType of storageTypes" [value]="storageType">
                    {{ storageType['storageTypeName'] }}
                  </mat-option>
                </mat-select>
              </mat-form-field>
              <mat-progress-bar mode="indeterminate" *ngIf="dbLoading"></mat-progress-bar>
            </div>
          </div>

          <div fxLayout="row" fxLayoutAlign="start start" class="field-row appname-row">
            <label fxFlex="45" fxFlexAlign="center">
              Storage System
            </label>
            <div fxFlex="55" fxFlexAlign="center">
              <mat-form-field [floatLabel]="'never'">
                <mat-select required placeholder="Required Field"
                            formControlName="storageSystem" (selectionChange)="onStorageSystemChange()">
                  <mat-option *ngFor="let storageSystem of storageSystems" [value]="storageSystem">
                    {{ storageSystem['storageSystemName'] }}
                  </mat-option>
                </mat-select>
              </mat-form-field>
              <mat-progress-bar mode="indeterminate" *ngIf="dbLoading"></mat-progress-bar>
            </div>
          </div>

          <div *ngIf="selectedStorageType==='Elastic'">
            <div fxLayout="row" fxLayoutAlign="start start">
              <label fxFlex="45" fxFlexAlign="center">
                ES Index
              </label>
              <div fxFlex="55" fxFlexAlign="center">
                <mat-form-field [floatLabel]="'never'">
                    <input type="text" matInput formControlName="container"
                           (ngModelChange)="filterContainers($event)"
                           [matAutocomplete]="containers" required placeholder="Required Field">
                    <mat-autocomplete #containers="matAutocomplete">
                      <mat-option *ngFor="let option of filteredContainers" [value]="option"
                                  (onSelectionChange)="containerSelect($event, option)" class="mat-option-sm">
                        {{ option }}
                      </mat-option>
                    </mat-autocomplete>
                </mat-form-field>
                <mat-progress-bar mode="indeterminate" *ngIf="dbLoading"></mat-progress-bar>
              </div>
            </div>

            <div fxLayout="row" fxLayoutAlign="start start">
              <label fxFlex="45" fxFlexAlign="center">
                ES Type
              </label>
              <div fxFlex="55" fxFlexAlign="center">
                <mat-form-field [floatLabel]="'never'">
                    <input type="text" matInput formControlName="object"
                           (ngModelChange)="filterObjects($event)"
                           [matAutocomplete]="objects" required placeholder="Required Field">
                    <mat-autocomplete #objects="matAutocomplete">
                      <mat-option *ngFor="let obj of filteredObjects" [value]="obj"
                                  (onSelectionChange)="objectSelect($event, obj)" class="mat-option-sm">
                        {{ obj }}
                      </mat-option>
                    </mat-autocomplete>
                </mat-form-field>
              </div>
            </div>
          </div>


          <div *ngIf="selectedStorageType==='Kafka'">
            <div fxLayout="row" fxLayoutAlign="start start">
              <label fxFlex="45" fxFlexAlign="center">
                Namespace
              </label>
              <div fxFlex="55" fxFlexAlign="center">
                <mat-form-field [floatLabel]="'never'">
                    <input type="text" matInput formControlName="container"
                           (ngModelChange)="filterContainers($event)"
                           [matAutocomplete]="containers" required placeholder="Required Field">
                    <mat-autocomplete #containers="matAutocomplete" force-select>
                      <mat-option *ngFor="let option of filteredContainers" [value]="option"
                                  (onSelectionChange)="containerSelect($event, option)" class="mat-option-sm">
                        {{ option }}
                      </mat-option>
                    </mat-autocomplete>
                </mat-form-field>

                <mat-progress-bar mode="indeterminate" *ngIf="dbLoading"></mat-progress-bar>
              </div>
            </div>


            <div fxLayout="row" fxLayoutAlign="start start">
              <label fxFlex="45" fxFlexAlign="center">
                Topic
              </label>
              <div fxFlex="55" fxFlexAlign="center">
                <mat-form-field [floatLabel]="'never'">
                    <input type="text" matInput formControlName="object"
                           (ngModelChange)="filterObjects($event)"
                           [matAutocomplete]="objects" required placeholder="Required Field">
                    <mat-autocomplete #objects="matAutocomplete">
                      <mat-option *ngFor="let obj of filteredObjects" [value]="obj"
                                  (onSelectionChange)="objectSelect($event, obj)" class="mat-option-sm">
                        {{ obj }}
                      </mat-option>
                    </mat-autocomplete>
                </mat-form-field>

                <mat-progress-bar mode="indeterminate" *ngIf="dbLoading"></mat-progress-bar>
              </div>
            </div>

          </div>


          <div *ngIf="selectedStorageType==='Hbase'">

            <div fxLayout="row" fxLayoutAlign="start start">
              <label fxFlex="45" fxFlexAlign="center">
                Namespace
              </label>
              <div fxFlex="55" fxFlexAlign="center">
                <mat-form-field [floatLabel]="'never'">
                    <input type="text" matInput formControlName="container"
                           (ngModelChange)="filterContainers($event)"
                           [matAutocomplete]="containers" required placeholder="Required Field">
                    <mat-autocomplete #containers="matAutocomplete">
                      <mat-option *ngFor="let option of filteredContainers" [value]="option"
                                  (onSelectionChange)="containerSelect($event, option)" class="mat-option-sm">
                        {{ option }}
                      </mat-option>
                    </mat-autocomplete>
                </mat-form-field>
                <mat-progress-bar mode="indeterminate" *ngIf="dbLoading"></mat-progress-bar>
              </div>
            </div>

            <div fxLayout="row" fxLayoutAlign="start start">
              <label fxFlex="45" fxFlexAlign="center">
                Table
              </label>
              <div fxFlex="55" fxFlexAlign="center">
                <mat-form-field [floatLabel]="'never'">
                    <input type="text" matInput formControlName="object"
                           (ngModelChange)="filterObjects($event)"
                           [matAutocomplete]="objects" required placeholder="Required Field">
                    <mat-autocomplete #objects="matAutocomplete">
                      <mat-option *ngFor="let obj of filteredObjects" [value]="obj"
                                  (onSelectionChange)="objectSelect($event, obj)" class="mat-option-sm">
                        {{ obj }}
                      </mat-option>
                    </mat-autocomplete>
                </mat-form-field>

              </div>
            </div>

          </div>


          <div *ngIf="selectedStorageType==='Teradata'">

            <div fxLayout="row" fxLayoutAlign="start start">
              <label fxFlex="45" fxFlexAlign="center">
                Database
              </label>
              <div fxFlex="55" fxFlexAlign="center">
                <mat-form-field [floatLabel]="'never'">
                    <input type="text" matInput formControlName="container"
                           (ngModelChange)="filterContainers($event)"
                           [matAutocomplete]="containers" required placeholder="Required Field">
                    <mat-autocomplete #containers="matAutocomplete">
                      <mat-option *ngFor="let option of filteredContainers" [value]="option"
                                  (onSelectionChange)="containerSelect($event, option)" class="mat-option-sm">
                        {{ option }}
                      </mat-option>
                    </mat-autocomplete>
                </mat-form-field>

                <mat-progress-bar mode="indeterminate" *ngIf="dbLoading"></mat-progress-bar>
              </div>
            </div>
            <div fxLayout="row" fxLayoutAlign="start start">
              <label fxFlex="45" fxFlexAlign="center">
                Table
              </label>
              <div fxFlex="55" fxFlexAlign="center">
                <mat-form-field [floatLabel]="'never'">
                    <input type="text" matInput formControlName="object"
                           (ngModelChange)="filterObjects($event)"
                           [matAutocomplete]="objects" required placeholder="Required Field">
                    <mat-autocomplete #objects="matAutocomplete">
                      <mat-option *ngFor="let obj of filteredObjects" [value]="obj"
                                  (onSelectionChange)="objectSelect($event, obj)" class="mat-option-sm">
                        {{ obj }}
                      </mat-option>
                    </mat-autocomplete>
                </mat-form-field>
              </div>
            </div>
          </div>


          <div *ngIf="selectedStorageType==='Hive'">
            <div fxLayout="row" fxLayoutAlign="start start">
              <label fxFlex="45" fxFlexAlign="center">
                Database
              </label>
              <div fxFlex="55" fxFlexAlign="center">
                <mat-form-field [floatLabel]="'never'">
                    <input type="text" matInput formControlName="container"
                           (ngModelChange)="filterContainers($event)"
                           [matAutocomplete]="containers" required placeholder="Required Field">
                    <mat-autocomplete #containers="matAutocomplete">
                      <mat-option *ngFor="let option of filteredContainers" [value]="option"
                                  (onSelectionChange)="containerSelect($event, option)" class="mat-option-sm">
                        {{ option }}
                      </mat-option>
                    </mat-autocomplete>
                </mat-form-field>
                <mat-progress-bar mode="indeterminate" *ngIf="dbLoading"></mat-progress-bar>
              </div>
            </div>
            <div fxLayout="row" fxLayoutAlign="start start">
              <label fxFlex="45" fxFlexAlign="center">
                Table
              </label>
              <div fxFlex="55" fxFlexAlign="center">
                <mat-form-field [floatLabel]="'never'">
                    <input type="text" matInput formControlName="object"
                           (ngModelChange)="filterObjects($event)"
                           [matAutocomplete]="objects" required placeholder="Required Field">
                    <mat-autocomplete #objects="matAutocomplete">
                      <mat-option *ngFor="let obj of filteredObjects" [value]="obj"
                                  (onSelectionChange)="objectSelect($event, obj)" class="mat-option-sm">
                        {{ obj }}
                      </mat-option>
                    </mat-autocomplete>
                </mat-form-field>
              </div>
            </div>
          </div>


          <div *ngIf="selectedStorageType==='HDFS'">
            <div fxLayout="row" fxLayoutAlign="start start">
              <div fxFlex="45" fxFlexAlign="center">
                <label>HDFS Path</label>
                <p class="info">
                  {{ hdfsPathHint }}
                </p>
              </div>
              <div fxFlex="55" fxFlexAlign="center">
                <mat-form-field [floatLabel]="'never'">
                    <input matInput required formControlName="hdfspath" placeholder="Required Field">
                    <mat-hint *ngIf="formErrors.hdfspath" class="alert-danger">
                      {{ formErrors.hdfspath }}
                    </mat-hint>
                </mat-form-field>

              </div>
            </div>

            <div fxLayout="row" fxLayoutAlign="start start">
              <label fxFlex="45" fxFlexAlign="center">
                File Format
              </label>
              <div fxFlex="55" fxFlexAlign="center">
                <mat-form-field [floatLabel]="'never'">
                  <mat-select required formControlName="fileFormat" placeholder="Required Field"
                              (selectionChange)="onFileFormatChange($event)">
                    <mat-option value="Parquet">Parquet</mat-option>
                    <mat-option value="ORC">ORC</mat-option>
                    <mat-option value="RCFile">RCFile</mat-option>
                    <mat-option value="Sequence">Sequence</mat-option>
                    <mat-option value="Text">Text</mat-option>
                    <mat-option value="Avro">Avro</mat-option>
                  </mat-select>
                </mat-form-field>
              </div>
            </div>

            <div *ngIf="selectedFileFormat==='Avro'">
              <div fxLayout="row" fxLayoutAlign="start start">
                <div fxFlex="45" fxFlexAlign="center">
                  <label>Schema Path</label>
                  <p class="info">
                    {{ schemaPathHint }}
                  </p>
                </div>
                <div fxFlex="55" fxFlexAlign="center">
                  <mat-form-field [floatLabel]="'never'">
                      <input matInput required formControlName="schemaPath" placeholder="Required Field">
                      <mat-hint *ngIf="formErrors.schemaPath" class="alert-danger">
                        {{ formErrors.schemaPath }}
                      </mat-hint>
                  </mat-form-field>

                </div>
              </div>
            </div>

            <div *ngIf="selectedFileFormat==='Text'">
              <div fxLayout="row" fxLayoutAlign="start start">
                <div fxFlex="45" fxFlexAlign="center">
                  <label>Fields Terminated By</label>
                  <p class="info">
                    {{ fieldTerminatorHint }}
                  </p>
                </div>
                <div fxFlex="55" fxFlexAlign="center">
                  <mat-form-field [floatLabel]="'never'">
                      <input matInput required formControlName="fieldTerminator" placeholder="Required Field">
                      <mat-hint *ngIf="formErrors.fieldTerminator" class="alert-danger">
                        {{ formErrors.fieldTerminator }}
                      </mat-hint>
                  </mat-form-field>

                </div>
              </div>
              <div fxLayout="row" fxLayoutAlign="start start">
                <div fxFlex="45" fxFlexAlign="center">
                  <label>Rows Terminated By</label>
                  <p class="info">
                    {{ rowTerminatorHint }}
                  </p>
                </div>
                <div fxFlex="55" fxFlexAlign="center">
                  <mat-form-field [floatLabel]="'never'">
                      <input matInput required formControlName="rowTerminator" placeholder="Required Field">
                      <mat-hint *ngIf="formErrors.rowTerminator" class="alert-danger">
                        {{ formErrors.rowTerminator }}
                      </mat-hint>
                  </mat-form-field>

                </div>
              </div>
            </div>
          </div>

          <div class="button-bar">
            <div fxLayout="row" fxLayoutAlign="center center" fxLayoutWrap="wrap">
              <div fxFlex="100" class="text-right button-bar-content">
                <button mat-button *ngIf="!submitting">Cancel</button>
                <button mat-button *ngIf="!submitting" color="primary" [disabled]="!datasetForm.valid" (click)="save()">
                  Register
                </button>
                <button mat-button *ngIf="submitting" color="primary" [disabled]="true">Submitting...</button>
              </div>

            </div>
          </div>
        </mat-card-content>
      </mat-card>
    </form>
  </div>
</div>
